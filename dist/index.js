!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SvgTree=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i="http://www.w3.org/2000/svg",r=function(){function r(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,r),this._element=this._createElement(e),this.setAttribute(n),"svg"===e&&this._element.setAttributeNS(null,"viewBox","0 0 "+n.width+" "+n.height)}return n(r,[{key:"getBBox",value:function(){return this._element.getBBox()}},{key:"setAttribute",value:function(t,n){var i={};"object"===("undefined"==typeof t?"undefined":e(t))?i=t:i[t]=n;var r=["stroke","fill","color","cursor"],o={};for(var l in i)this[l]=i[l],r.indexOf(l)>-1?o[l]=i[l]:this._element.setAttributeNS(null,l,i[l]);var a="";for(var h in o)a+=h+": "+o[h]+";";a&&this._element.setAttributeNS(null,"style",a)}},{key:"setContent",value:function(e){return this._element.innerHTML=e,this}},{key:"appendChild",value:function(e){this._element.appendChild(e.element)}},{key:"path",value:function(e,t,n,i,r){this.setAttribute({stroke:r,fill:"none"}),this._updatePath(e,t,n,i)}},{key:"clear",value:function(){for(;this._element.lastChild;)this._element.removeChild(this._element.lastChild)}},{key:"bindEvent",value:function(e,t){this._element.addEventListener(e,t,!1)}},{key:"_updatePath",value:function(e,t,n,i){var r={x:(n-e)/2+e,y:(i-t)/2+t};r.x;this.setAttribute("d","M"+e+" "+t+" C"+((n-e)/8*7+e)+" "+t+" "+((n-e)/8+e)+" "+i+" "+n+" "+i)}},{key:"_createElement",value:function(e){return document.createElementNS(i,e)}},{key:"element",get:function(){return this._element}}]),r}(),o={normal:{fill:"#00C0FF",stroke:"none",color:"white",circleColor:"white"},root:{stroke:"#f0f0f0",fill:"none",color:"black",circleColor:"#00C0FF"}},l={lineHeight:24,padding:5,circleR:5},a=function(){function e(n){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,e),i.type||(i.type="normal");var a=o[i.type],h=Date.now()+""+(1e5*Math.random()|0),c=new r("g",{id:h,is_node:1,cursor:"pointer"}),s=new r("text",{x:2*l.circleR+2*l.padding,color:a.color,"text-rendering":"geometricPrecision"}).setContent(n),d=new r("rect",{stroke:a.stroke,fill:a.fill,height:l.lineHeight+2*l.padding}),u=new r("circle",{r:l.circleR,cx:l.circleR+l.padding,cy:(l.lineHeight+2*l.padding)/2,stroke:"none",fill:a.circleColor});c.appendChild(d),c.appendChild(u),c.appendChild(s);var f={id:h,title:n,x:0,y:0,type:i.type,width:0,height:0,isShow:!0,childrenShow:!0,direction:"right",maxChildren:0,children:[],_elements:{wrapper:c,border:d,text:s,itemSymbol:u}};return setTimeout(function(){var e=s.getBBox();d.setAttribute("width",e.width+3*l.padding+2*l.circleR),s.setAttribute("y",e.height+l.padding+(l.lineHeight-e.height)/2)},0),Object.assign(this,f)}return n(e,[{key:"bindEvent",value:function(e,t){"function"==typeof t&&this.wrapper.bindEvent(e,t)}},{key:"setPosition",value:function(e){this.x=e.x,this.y=e.y,this._elements.wrapper.setAttribute({transform:"translate("+e.x+","+e.y+")",x:e.x,y:e.y})}},{key:"hide",value:function(){this._elements.wrapper.setAttribute({display:"none"})}},{key:"show",value:function(){this._elements.wrapper.setAttribute({display:"block"})}},{key:"getBBox",value:function(){return this._elements.wrapper.getBBox()}},{key:"element",get:function(){return this._elements.wrapper}}]),e}(),h=800,c=500,s=function(){function e(n,i){t(this,e),this.width=i.width||h,this.height=i.height||c,this._svg=new r("svg",{width:i.width,height:i.height}),this._canvas=new r("g",{width:i.width,height:i.height}),this._dnd(),this._svg.appendChild(this._canvas),n.appendChild(this._svg.element)}return n(e,[{key:"_dnd",value:function(){var e=new r("rect",{width:this._canvas.width,height:this._canvas.height,style:"stroke:none;fill:white;cursor:-webkit-grab;"});this._svg.appendChild(e),e=e.element;var t=this._canvas;t.x=0,t.y=0,t.scale=1,function(){var n,i,r,o,l=!1;e.addEventListener("mousedown",function(e){console.log("mousedown"),n=t.x,i=t.y,r=e.pageX,o=e.pageY,l=!0},!1),document.addEventListener("mousemove",function(e){if(l){var a=e.pageX-r,h=e.pageY-o;t.x=n+a,t.y=i+h,t.setAttribute("transform","translate("+t.x+","+t.y+"),scale("+t.scale+")")}},!1),document.addEventListener("mouseup",function(e){l=!1},!1);var a;e.addEventListener("mousewheel",function(e){if(e.ctrlKey){var n=e.deltaY;if(0!==n)return n>0?n=1-.0125*n:n<0&&(n=1-.0125*n),t.scale*=n,t.scale<.1&&(t.scale=.1),t.scale>2&&(t.scale=2),clearTimeout(a),a=setTimeout(function(){t.scale>=.9&&t.scale<=1.1&&(t.scale=1,t.setAttribute("transform","translate("+t.x+","+t.y+"),scale("+t.scale+")"))},100),t.setAttribute("transform","translate("+t.x+","+t.y+"),scale("+t.scale+")"),!1}},!1)}()}},{key:"clear",value:function(){this._canvas.clear()}},{key:"bindEvent",value:function(e,t){"function"==typeof t&&this._canvas.bindEvent(e,t)}},{key:"appendNode",value:function(e){this._canvas.appendChild(e.element)}},{key:"appendPath",value:function(e){this._canvas.appendChild(e)}}]),e}(),d=150,u=50,f=function(){function e(n){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,e),this._canvas=new s(n,i)}return n(e,[{key:"renderTree",value:function(e){this._hashMap={},this._connectMap={},this._tree=this._buildTree(e),this._renderTree(this._tree),this._toggle()}},{key:"_countChildren",value:function(e){var t=function e(t){if(!t.children||!t.children.length)return 1;if(!t.isShow)return 0;var n=0;return t.children.forEach(function(t){n+=e(t)}),n};return t(e)}},{key:"_decideRootLeftRight",value:function(e){var t=this,n=0,i=0;e.children.forEach(function(r,o){var l=e.children[o];i>n?(l.direction="left",n+=t._countChildren(r)):(l.direction="right",i+=t._countChildren(r))})}},{key:"_reCountRootChildren",value:function(e){var t=this;e.count={left:0,right:0},e.children.forEach(function(n,i){var r=e.children[i],o=t._countChildren(n);e.count[r.direction]+=o})}},{key:"_buildChildren",value:function(e,t){var n=this;return this._hashMap[e.id]=e,e.children=[],t.children&&(e.children=t.children.map(function(e){var t=new a(e.title,{type:"normal"});return n._buildChildren(t,e)})),e}},{key:"_toggleTree",value:function(e,t){var n=this;e.children&&e.children.forEach(function(e){e.isShow=t,e.childrenShow=t,n._toggleTree(e,t)})}},{key:"_toggle",value:function(){var e=this;this._canvas.bindEvent("click",function(t){for(var n=t.target;n&&1!=n.getAttribute("is_node");)n=n.parentNode;if(n){var i=n.id,r=e._hashMap[i];r.childrenShow=!r.childrenShow,e._toggleTree(r,r.childrenShow),console.log(e._tree,r),e._renderTree(e._tree)}})}},{key:"_buildTree",value:function(e,t,n){var i,r=this;return t?i=t.children[n]:(i=new a(e.title,{type:"root"}),this._buildChildren(i,e)),this._canvas.appendNode(i),i.children&&i.children.forEach(function(e,t){r._buildTree(e,i,t)}),i}},{key:"_renderTree",value:function(e,t,n){var i=this;e.isShow?e.show():e.hide();var r={},o=0;if(e.maxChildren=this._countChildren(e),"root"===e.type)this._decideRootLeftRight(e),this._reCountRootChildren(e),r.x=this._canvas.width/2,r.y=this._canvas.height/2;else{"root"===t.type&&(n=e.direction,t.maxChildren=t.count[n]);var l=1;"left"===n&&(l=-1);var a=d*l;r.x=t.x+a,t[n]||(t[n]=0),o=t[n],e.maxChildren||(e.maxChildren=1),t[n]+=e.maxChildren,"基础知识"===e.title&&console.log(t.y,t.maxChildren,o,e.maxChildren),r.y=t.y-(t.maxChildren/2-(o+e.maxChildren/2))*u}return e.setPosition(r),t&&(e.isShow?this._connect(t,e,n):this._disconnect(t,e)),e.left=0,e.right=0,e.children&&e.children.forEach(function(t,r){i._renderTree(t,e,n)}),e}},{key:"_connect",value:function(e,t,n){var i=this;setTimeout(function(){var o,l,a=e.getBBox(),h=t.getBBox();n||(n="right"),"left"===n?(o=+e.x,l=+t.x+h.width):"right"===n&&(o=+e.x+a.width,l=+t.x);var c=["#A157E5","#24BAE5","#DEE03C","#12E13C","#0BE2C5","#F37F78","#00ACDF"][7*Math.random()|0],s=e.id+""+t.id,d=i._connectMap[s];d||(d=new r("path"),i._canvas.appendPath(d),i._connectMap[s]=d),d.setAttribute("display","block"),d.path(o,+e.y+a.height/2,l,+t.y+h.height/2,c)},0)}},{key:"_disconnect",value:function(e,t){var n=e.id+""+t.id,i=this._connectMap[n];i.setAttribute("display","none")}}]),e}(),v=function(){function e(n){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,e),this._tree=new f(n,i),i.nodeList&&this.renderTree(i.nodeList)}return n(e,[{key:"renderTree",value:function(e){this._tree.renderTree(e)}}]),e}();return v});