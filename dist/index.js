!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SvgTree=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i="http://www.w3.org/2000/svg",r=function(){function r(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,r),this._element=this._createElement(e),this.setAttribute(n),"svg"===e&&this._element.setAttributeNS(null,"viewBox","0 0 "+n.width+" "+n.height)}return n(r,[{key:"getBBox",value:function(){return this._element.getBBox()}},{key:"setAttribute",value:function(t,n){var i={};"object"===("undefined"==typeof t?"undefined":e(t))?i=t:i[t]=n;var r=["stroke","fill","color"],o={};for(var a in i)this[a]=i[a],r.indexOf(a)>-1?o[a]=i[a]:this._element.setAttributeNS(null,a,i[a]);var l="";for(var c in o)l+=c+": "+o[c]+";";l&&this._element.setAttributeNS(null,"style",l)}},{key:"setContent",value:function(e){this._element.innerHTML=e}},{key:"appendChild",value:function(e){console.log(this._element,"appendChild",e._element),this._element.appendChild(e._element)}},{key:"path",value:function(e,t,n,i,r){this.setAttribute({stroke:r,fill:"none"}),this._updatePath(e,t,n,i)}},{key:"_updatePath",value:function(e,t,n,i){var r={x:(n-e)/2+e,y:(i-t)/2+t};r.x;this.setAttribute("d","M"+e+" "+t+" C"+((n-e)/8*7+e)+" "+t+" "+((n-e)/8+e)+" "+i+" "+n+" "+i)}},{key:"_createElement",value:function(e){return document.createElementNS(i,e)}},{key:"element",get:function(){return this._element}}]),r}(),o={normal:{fill:"#00C0FF",stroke:"none",color:"white",circleColor:"white"},root:{stroke:"#f0f0f0",fill:"none",color:"black",circleColor:"#00C0FF"}},a={lineHeight:24,padding:5,circleR:5},l=function e(n,i){var l=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];t(this,e),l.type||(l.type="normal");var c=o[l.type],h=new r("g",{transform:"translate("+n.x+","+n.y+")",x:n.x,y:n.y}),s=new r("text",{x:2*a.circleR+2*a.padding,color:c.color,"text-rendering":"geometricPrecision"});s.setContent(i);var d=new r("rect",{stroke:c.stroke,fill:c.fill,height:a.lineHeight+2*a.padding}),u=new r("circle",{r:a.circleR,cx:a.circleR+a.padding,cy:(a.lineHeight+2*a.padding)/2,stroke:"none",fill:c.circleColor});return h.appendChild(d),h.appendChild(u),h.appendChild(s),setTimeout(function(){var e=s.getBBox();d.setAttribute("width",e.width+3*a.padding+2*a.circleR),s.setAttribute("y",e.height+a.padding+(a.lineHeight-e.height)/2)},0),h},c=800,h=500,s=150,d=50,u=function(){function e(n){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,e),this._svg=new r("svg",{width:i.width||c,height:i.height||h}),this._canvas=new r("g",{width:i.width||c,height:i.height||h}),this._dnd(),this._svg.appendChild(this._canvas),n.appendChild(this._svg.element)}return n(e,[{key:"renderTree",value:function(e){this._drawNode(e)}},{key:"_dnd",value:function(){var e=new r("rect",{width:this._canvas.width,height:this._canvas.height,style:"stroke:none;fill:white;cursor:-webkit-grab;"});this._svg.appendChild(e),e=e.element;var t=this._canvas;t.x=0,t.y=0,t.scale=1,function(){var n,i,r,o,a=!1;e.addEventListener("mousedown",function(e){console.log("mousedown"),n=t.x,i=t.y,r=e.pageX,o=e.pageY,a=!0},!1),document.addEventListener("mousemove",function(e){if(a){var l=e.pageX-r,c=e.pageY-o;t.x=n+l,t.y=i+c,t.setAttribute("transform","translate("+t.x+","+t.y+"),scale("+t.scale+")")}},!1),document.addEventListener("mouseup",function(e){a=!1},!1);var l;e.addEventListener("mousewheel",function(e){if(e.ctrlKey){var n=e.deltaY;if(0!==n)return n>0?n=1-.0125*n:n<0&&(n=1-.0125*n),t.scale*=n,t.scale<.1&&(t.scale=.1),t.scale>2&&(t.scale=2),clearTimeout(l),l=setTimeout(function(){t.scale>=.9&&t.scale<=1.1&&(t.scale=1,t.setAttribute("transform","translate("+t.x+","+t.y+"),scale("+t.scale+")"))},100),t.setAttribute("transform","translate("+t.x+","+t.y+"),scale("+t.scale+")"),!1}},!1)}()}},{key:"_countChildren",value:function(e){var t=function e(t){if(!t.children)return 1;var n=0;return t.children.forEach(function(t){n+=e(t)}),n};return t(e)}},{key:"_decideRootLeftRight",value:function(e){var t=this,n=0,i=0;e.children.forEach(function(e){i>n?(e.direction="left",n+=t._countChildren(e)):(e.direction="right",i+=t._countChildren(e))})}},{key:"_reCountRootChildren",value:function(e){var t=this;e.count={left:0,right:0},e.children.forEach(function(n){var i=t._countChildren(n);e.count[n.direction]+=i})}},{key:"_drawNode",value:function(e,t,n){var i=this;e.maxChildren=this._countChildren(e);var r={},o=0,a="normal";if(t){t._root&&(n=e.direction,t.maxChildren=t.count[n]);var c=1;"left"===n&&(c=-1);var h=s*c;r.x=t._node.x+h,t[n]||(t[n]=0),o=t[n],e.maxChildren||(e.maxChildren=1),t[n]+=e.maxChildren,r.y=t._node.y-(t.maxChildren/2-(o+e.maxChildren/2))*d}else e._root=!0,a="root",this._decideRootLeftRight(e),this._reCountRootChildren(e),r.x=this._canvas.width/2,r.y=this._canvas.height/2;var u=new l(r,e.title,{type:a});return e._node=u,this._canvas.appendChild(u),t&&this._connect(t._node,u,n),e.children&&e.children.forEach(function(t){i._drawNode(t,e,n)}),u}},{key:"_connect",value:function(e,t,n){var i=this;setTimeout(function(){var o,a,l=e.getBBox(),c=t.getBBox();n||(n="right"),"left"===n?(o=+e.x,a=+t.x+c.width):"right"===n&&(o=+e.x+l.width,a=+t.x);var h=["#A157E5","#24BAE5","#DEE03C","#12E13C","#0BE2C5","#F37F78","#00ACDF"][7*Math.random()|0],s=new r("path");s.path(o,+e.y+l.height/2,a,+t.y+c.height/2,h),i._canvas.appendChild(s)},0)}}]),e}(),f=function(){function e(n){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];t(this,e),this._tree=new u(n,i),i.nodeList&&this.renderTree(i.nodeList)}return n(e,[{key:"renderTree",value:function(e){this._tree.renderTree(e)}}]),e}();return f});